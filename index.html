<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WesXC Runs</title>
  <link rel="icon" type="image/png" href="WesLogo.png" sizes="32x32" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.css" rel="stylesheet" />
  <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>

  
  <script src = "routes.js"></script>
  <style>
    body { margin: 0; padding: 0;}
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    .container {
      display: inline-block;
    }
    #RouteTable {
        text-align: center;
    overflow: auto;
      position: fixed;
      bottom: 0px;
      left: 0px;
      width: 22%;
      height: 100%;
      background-color: white;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
      z-index: 1;
    border: 1px solid black;
    }
  #showInfoDiv {
    display: none;
        text-align: center;
      position: absolute;
      top: 0px;
      left: 24.8%;
      width: 12%;
      height: auto;
      background-color: white;
      padding: 5px 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
      z-index: 1;
    border: 1px solid black;
    }
    table {
        left: 0px;
  border-collapse: collapse;
  width: 100%;
}
.extraInfo {
    font-family: Arial, sans-serif;
    font-size: 16px;
    /* Add any other font styles you want */
  }
#toggleSat{
    position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 10px 20px;
  background-color: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
#toggleSelect{
    position: fixed;
  bottom: 30px;
  right: 20px;
  padding: 10px 20px;
  background-color: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}

th, td {
  border: 1px solid black;
  padding: 8px;
}

.image-button {
      background-color: transparent;
      border: none;
      padding: 0;
      cursor: pointer;
      position: absolute;
      left: 22%;
      top: 0%;
      width: 30px;
      height: 24px;
      z-index: 2;
      background-image: url("leftarrow.png"); /* Add the path to your image here */
      background-size: 100% 100%; /* Adjust image size to fit the button */
    }
    .image-button2 {
      display: none;
      background-color: transparent;
      border: none;
      padding: 0;
      cursor: pointer;
      position: absolute;
      left: 0%;
      top: 0%;
      width: 30px;
      height: 24px;
      z-index: 2;
      background-image: url("rightarrow.png"); /* Add the path to your image here */
      background-size: 100% 100%; /* Adjust image size to fit the button */
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
      z-index: 999; /* Ensure the overlay is on top of other elements */
    }

    /* Styles for the pop-up content */
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      z-index: 1000; /* Ensure the pop-up is on top of other elements */
      font-size: 20px;
    }

    /* Styles for the close button */
    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
    }

    h3 {
      color: #333;
      font-size: 20px;
      margin: 5px 0 !important; /* Set margin to 0 to remove any default spacing around the heading */
      padding: 5px 0; /* Adjust the padding to control the spacing between heading and div */
    }
    div {
      padding: 5px;
    }



  </style>
</head>
<body>
  <div id="map"></div>
  <div class="overlay" id="overlay"></div>
  <div class="popup" id="popup">
    <span class="close-button" onclick="closePopup()">&times;</span>
    <p>Welcome to WesXC Routes! Here you can explore all of our teams runs and explore different options 
      to expand your route choices! To view a run on the map simply click on it's row of the table to show
      or hide the map! You are currently in single-select mode where showing
      a new route will hide the previous route, however if you'd like you can use the bottom right button to
    change to Multi-Select Mode where you can see any number of runs at once! <br><br>I'm currently just trying to get
      all the features down so for 
      now the graphics are very janky and a lot of things are just styled enough to be useful. I'm currently
      working on adding more of our routesand working 
      on a satellite vs street map toggle, but would love to hear feedback for more changes or improvements! Enjoy!
    </p>
  </div>
  <button id="toggleSat" onclick = "toggleSattellite()">Use Street View</button>
  <button id="toggleSelect" onclick = "toggleSelect()">Use Multi Select</button>
  <div class="scrollable-div" id = "RouteTable">
    <h1>Wes XC Runs</h1>
    <table id = "routes">
        <tr>
          <th>Name</th>
          <th>Distance</th>
          
        </tr>
      </table> 
  </div>
  <div id = showInfoDiv></div>
  <button class="image-button" id = "hide" onclick = "hideTable()"> </button>
  <button class="image-button2" id = "show" onclick = "showTable()"> </button>
 

  <script>
    var clickOrder = new Array(0);
    var curSingle = true;
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2FtYXJudyIsImEiOiJjbGl1c2F1dDAwOW02M3BueTJwdDViNHY4In0.5F8W4nYLQk7H0xjRONCGkw'; // Replace with your Mapbox access token

    var map = new mapboxgl.Map({
      container: 'map', // Container ID
      style: 'mapbox://styles/mapbox/satellite-streets-v11', // Mapbox Satellite Streets style
      center: [-72.66114, 41.551358], // Initial center coordinates (longitude, latitude)
      zoom: 14 // Initial zoom level
    });

    map.on('load', function() {
        for (var i=0; i<runs.length; i++){
            addLayer(runs[i][2].features[0].geometry.coordinates[0],runs[i][0],"blue")
            map.setLayoutProperty(runs[i][0], 'visibility', 'none');
        }
}
);

    document.getElementById('toggleSat').style.display = 'none'
    


    

    var table = document.getElementById("routes")
    var row;
    var cell;
    //var button;
    for (var i=0; i<runs.length; i++){
        row = table.insertRow();
        for (var j = 0; j<2; j++){
            row.insertCell();
        }
        row.cells[0].innerHTML = runs[i][0]
        row.cells[1].innerHTML = runs[i][1]+"";
        row.cells[0].addEventListener("click", show);
        row.cells[1].addEventListener("click", show);
        row.cells[0].addEventListener("contextmenu", showInfo);
        row.cells[1].addEventListener("contextmenu", showInfo);
        row.cells[0].style.backgroundColor = "#C21807";
        row.cells[1].style.backgroundColor = '#C21807';
        if (!runs[i][3].includes("Comments: </p>")){
            row.cells[0].style.color = "white";
        row.cells[1].style.color = 'white';
        }
        else{
            row.cells[0].style.color = "blue";
         row.cells[1].style.color = "blue";
        }
    }

    var overlay = document.getElementById('overlay');
    var popup = document.getElementById('popup');
    
    function showPopup() {
      overlay.style.display = 'block';
      popup.style.display = 'block';
    }

    function closePopup() {
      overlay.style.display = 'none';
      popup.style.display = 'none';
    }
    window.onload = showPopup;


    function toggleSattellite() {
        console.log(map.getStyle().layers)
        for (var i=0; i<runs.length; i++){
            map.removeLayer(runs[i][0])
            map.removeSource(runs[i][0])
        }
        if (document.getElementById('toggleSat').textContent=="Use Street View"){
            document.getElementById('toggleSat').textContent = "Use Sattelite View";
            map.setStyle('mapbox://styles/mapbox/streets-v11');
        }
        else{
            document.getElementById('toggleSat').textContent = "Use Street View";
            map.setStyle('mapbox://styles/mapbox/satellite-streets-v11');
        }
        for (var i=0; i<runs.length; i++){
            addLayer(runs[i][2].features[0].geometry.coordinates[0],runs[i][0],"blue")
        }
        console.log("")
        console.log(map.getStyle().layers)
  }

    function show(event){
      var clickedRow = event.target.parentElement;
    var index = Array.from(clickedRow.parentNode.children).indexOf(clickedRow);
        
        if (document.getElementById("routes").rows[index].cells[0].style.backgroundColor =="black"){
            map.setLayoutProperty(runs[index-1][0], 'visibility', 'none');
            document.getElementById("routes").rows[index].cells[0].style.backgroundColor = '#C21807'
            document.getElementById("routes").rows[index].cells[1].style.backgroundColor = '#C21807'
            clickOrder.splice(clickOrder.indexOf(index-1),1)
            if (clickOrder.length==0){
              document.getElementById("showInfoDiv").style.display = 'none'
            }
            else{
              if (runs[clickOrder[clickOrder.length-1]][3]!=document.getElementById("showInfoDiv").innerHTML){
                document.getElementById("showInfoDiv").innerHTML = runs[clickOrder[clickOrder.length-1]][3]
              }
              
            }
           
        }
        else{
            map.setLayoutProperty(runs[index-1][0], 'visibility', 'visible');
            document.getElementById("routes").rows[index].cells[0].style.backgroundColor = "black"
            document.getElementById("routes").rows[index].cells[1].style.backgroundColor = "black"
            showInfo(index)
            if (curSingle && clickOrder.length!=0){
                map.setLayoutProperty(runs[clickOrder[0]][0], 'visibility', 'none');
              document.getElementById("routes").rows[clickOrder[0]+1].cells[0].style.backgroundColor = '#C21807'
              document.getElementById("routes").rows[clickOrder[0]+1].cells[1].style.backgroundColor = '#C21807'
              clickOrder = new Array(0)
              }
            clickOrder.push(index-1)
        }

    }

    function showInfo(rowIndex){
      document.getElementById("showInfoDiv").style.display = 'block'
      document.getElementById("showInfoDiv").innerHTML = runs[rowIndex-1][3];
    }

    function showTable(){
        document.getElementById("show").style.display = 'none';
        document.getElementById("hide").style.display = 'block';
        document.getElementById("RouteTable").style.display = 'block';
        document.getElementById("showInfoDiv").style.display = 'block'
    }

    function hideTable(){
       document.getElementById("show").style.display = 'block';
        document.getElementById("hide").style.display = 'none';
        document.getElementById("RouteTable").style.display = 'none';
        document.getElementById("showInfoDiv").style.display = 'none'
    }

    function toggleSelect(){
      curSingle = document.getElementById("toggleSelect").textContent != "Use Single Select";
      if (!curSingle){
        document.getElementById("toggleSelect").textContent = "Use Multi Select"
        curSingle = true;
        if (clickOrder.length>0){
          for (var i=0; i<clickOrder.length-1; i++){
          map.setLayoutProperty(runs[clickOrder[i]][0], 'visibility', 'none');
            document.getElementById("routes").rows[clickOrder[i]+1].cells[0].style.backgroundColor = '#C21807'
            document.getElementById("routes").rows[clickOrder[i]+1].cells[1].style.backgroundColor = '#C21807'
        }
        clickOrder[0] = clickOrder[clickOrder.length-1]
        clickOrder.splice(1)
        }
      }
      else{
        document.getElementById("toggleSelect").textContent = "Use Single Select"
        curSingle = false;
      }
    }

   



    function addLayer(coords,name,color){
        map.addLayer({
        "id": name,
        "type": "line",
        "source": {
            "type": "geojson",
            "data": {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "LineString",
                    "coordinates": coords
                }
            }
        },

        "layout": {
            "line-join": "round",
            "line-cap": "round"
        },
        "paint": {
            "line-color": "#C21807",
            "line-width": 4
        }
    })
    }
  </script>
</body>
</html>